<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vector Field Visualization with Three.js</title>
  <style>
    body { margin: 0; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="OrbitControls.js"></script>

  <script>
        // Set up scene, camera, and renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        controls = new THREE.OrbitControls(camera, renderer.domElement);

        // Add a directional light
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(1, 1, 1).normalize();
        scene.add(light);

        // Define your vector array
        const vectorArray = [
        new THREE.Vector3(1, 0, 0),
        new THREE.Vector3(0, 1, 0),
        new THREE.Vector3(0, 0, 1)
        ];

        function onWindowResize( event ) {
            //	uniforms.resolution.value.x = window.innerWidth;
            //	uniforms.resolution.value.y = window.innerHeight;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );
        }

        // Function to create an arrow from a vector
        function createArrow(vector, origin, color, len) {
        const arrowHelper = new THREE.ArrowHelper(vector.normalize(), origin, len*vector.length(), color);
        return arrowHelper;
        }

        function f(r, w)
        {
            return 2 * Math.PI * r; 
        }


        let r = 0;
        let R = 1;
        let theta = 0;
        let dr = 0.2;
        let dtheta = 10;
        let eps = 1e-9;
        while (r <= R)
        {
            let w = 8 * dr;
            let w2 = w * w;

            theta = 0;
            while (theta < 360)
            {
                let x = r * Math.cos(theta * Math.PI / 180.) * r;
                let y = r * Math.sin(theta * Math.PI / 180.) * r;
                let r2 = x * x + y * y;

                // pol =1 , charge = 1
                let mz = 2 * (Math.exp(-r2 / w2) - 0.5);
                let mx = (x / (r + eps)) * (1 - Math.abs(mz));
                let my = (y / (r + eps)) * (1 - Math.abs(mz)); 

                let v = new THREE.Vector3(mx, 
                                          my,
                                          mz);
                                          
                if (mz < 0)
                    color = (Math.round( Math.abs(mz) * 255.) << 16);
                else
                    color = (Math.round(Math.abs(mz) * 255.));

                color = color + ((Math.round(Math.sqrt(mx * mx + my * my) * 255)) << 8);
                console.log(Math.round(Math.sqrt(mx * mx + my * my) * 255));

                const arrow = createArrow(v, new THREE.Vector3(x, y, 0), color,0.05);
                scene.add(arrow);

                theta += dtheta;
            }
            r += dr;
            dr = 0.82 * dr;
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        animate();
  </script>
</body>
</html>